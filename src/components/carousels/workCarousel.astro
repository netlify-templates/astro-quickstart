---
import Carousel from '../carousel.astro'
import LargeImage from '../largeImage.astro'

const { carouselIndex } = Astro.props

var images = []

var members = [
    {
        username: 'maya', 
        images: await import.meta.glob('../../../members/maya/renamedPortfolio/*'), 
        fullRes: [], 
    }, 
    {
        username: 'isabelle', 
        images: await import.meta.glob('../../../members/isabelle/renamedPortfolio/*'), 
        fullRes: [], 
    }, 
    {
        username: 'tyler', 
        images: await import.meta.glob('../../../members/tyler/renamedPortfolio/*'), 
        fullRes: [], 
    }, 
    {
        username: 'shikha', 
        images: await import.meta.glob('../../../members/shikha/renamedPortfolio/*'), 
        fullRes: [], 
    }, 
    {
        username: 'samantha', 
        images: await import.meta.glob('../../../members/samantha/renamedPortfolio/*'), 
        fullRes: [], 
    }, 
]


members.forEach((m, i) => {
    m.imgs = []
    for (const path in m.images) {
        m.images[path]().then((mod) => {
            m.imgs.push(mod)
        })
    }
    members[i].imgs = m.images
    
    m.imgs.forEach(img => {
        img = img.default
        
        if (typeof img === 'object') {
            img.username = m.username

            var fullRes = members[i].fullRes.filter(r => r.name === getFNameNoExt(img.src))
            if (fullRes.length > 0) {
                img.fullRes = fullRes[0].src
            }

            var alreadyHas = images.filter(i => getFNameNoExt(i.src) === getFNameNoExt(img.src))
            if (!alreadyHas) images.push(img)
        }
        else members[i].fullRes.push(getFNameNoExt(img))
    })
})

images.forEach((img, i) => {
    var username = img.username
    var member = members.filter(m => m.username === username)[0]
        
    var fullRes = member.fullRes.filter(r => r.name === getFNameNoExt(img.src))
    if (fullRes.length > 0) {
        img.fullRes = fullRes[0].src
    }

    images[i] = img
})

function getFName(str) {
    if (str.includes('/')) str = str.split('/').slice(-1)[0]
    return str
}

function getFNameNoExt(str) {
  if (str.includes('/')) str = str.split('/').slice(-1)[0]
  str = str.slice(0, -1*getFExt(str, 2).length)

  return str
}

function getFExt(str, level=1) {
  str = getFName(str)
  if (level > 0) level *= -1
  if (str.includes('.')) {
    str = str.split('.')
    switch (level) {
      case 0: 
        break
      default: 
        str = str.slice(level)
        break
    }
    str = str.join('.')
  }
  return str
}

function toProper(user) {
    user = `${user.slice(0, 1).toUpperCase()}${user.slice(1)}`
    return user
}

var dId = 'workCarousel'
---
<Carousel carouselIndex={carouselIndex} dataColumns={images.length} dataId={dId}>
    {
        (
            images.map((img, i) => {
                <LargeImage id={`${dId}-${i}`} src={img.src} alt={`${getFNameNoExt(img.src)} by ${toProper(img.username)}`} draggable={false} fullRes={img.fullRes} />
            })
        )
    }
</Carousel>